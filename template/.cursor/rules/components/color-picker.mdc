# rule: Component – Color Picker
type: intelligent
scope: **/*
---
## Overview
Short purpose and when-to-use guidance for **Color Picker**.

## Anatomy
- Structure and slots (leading/trailing/media/actions/meta if applicable).

## Props (typed)
- List key props with types, defaults, and constraints.

## States
- Hover, focus, active, disabled, loading, invalid.

## Accessibility
- Roles, labels, keyboard, focus outline, ARIA attributes.

## Usage Examples
- Basic usage
- With slots (icon/text/secondary action)
- Edge cases (long text, truncation)

## Do / Don't
- Do: keep API surface small; reuse Foundations tokens.
- Don't: hardcode colors; expose unstable DOM structure.

## Notes
Merged documentation from repository and component docs (if present).

---

### Source Docs
# Color Picker

## Visão geral

`ColorPicker` é um conjunto de componentes modulares para seleccionar cores de forma interactiva.  Suporta actualização em tempo real, navegação por teclado e funciona em dispositivos de toque【168320816425453†L17-L24】.  A arquitectura composável permite criar a interface de cor ideal para diferentes cenários.

## Funcionalidades principais

- **Arquitectura composável**: combine diferentes partes como área 2D, controlos de matiz, saturação, luminosidade e opacidade【168320816425453†L27-L35】.
- **Actualização em tempo real**: reflecte imediatamente a cor seleccionada enquanto o utilizador interage【168320816425453†L17-L22】.
- **Navegação por teclado**: setas permitem ajustes precisos【168320816425453†L20-L22】.
- **Acessibilidade**: implementa padrões ARIA para leitores de ecrã【168320816425453†L21-L23】.
- **Suporte a toque**: optimizado para dispositivos móveis【168320816425453†L23-L24】.

## Dependências

- Biblioteca `chroma-js` para conversões de cor【168320816425453†L7-L12】.

## Anatomia

Um exemplo de composição:

```tsx
<ColorPicker>
  <ColorPickerArea />
  <ColorPickerHue />
  <ColorPickerSaturation />
  <ColorPickerLightness />
  <ColorPickerAlpha />
</ColorPicker>
```【168320816425453†L27-L35】

## API

### ColorPicker

| Propriedade | Tipo | Predefinição | Descrição |
| --- | --- | --- | --- |
| **color** | `[hue, saturation, value, alpha]` | `[0, 1, 1, 1]` | Valor da cor em formato HSVA (hue 0‑360, saturação/valor 0‑1)【168320816425453†L45-L50】. |
| **onColorChange** | `(color: HSVA) => void` | – | Callback ao modificar a cor【168320816425453†L52-L57】. |
| **disabled** | `boolean` | `false` | Desactiva a interacção【168320816425453†L58-L63】. |

### Partes individuais

- **ColorPickerArea**: selecção 2D de saturação e valor.
- **ColorPickerHue**: selector horizontal para o matiz.
- **ColorPickerSaturation**: ajusta saturação da cor actual.
- **ColorPickerLightness**: ajusta luminosidade da cor actual.
- **ColorPickerAlpha**: ajusta a opacidade e apresenta padrão quadriculado【168320816425453†L67-L87】.

## Boas práticas

- **Formato de cor**: armazene a cor internamente em HSVA e converta para outros formatos (HEX, RGB, HSL) apenas para exibição ou exportação【168320816425453†L111-L115】.
- **Composição**: combine apenas os controlos necessários para o seu caso (por exemplo, `Area + Hue` para a maioria dos cenários; adicione `Alpha` se precisar de opacidade)【168320816425453†L117-L122】.
- **Acessibilidade**: garanta contraste entre o cursor/handle e o fundo; teste a navegação por teclado e forneça rótulos claros【168320816425453†L124-L128】.

## Source Snapshot
_Synced from foundations-main (read-only)._

**src/foundations/ui/color-picker/color-picker.tsx**

```tsx
"use client";

import chroma from "chroma-js";
import { createContext, use, useMemo, useRef } from "react";

import { composeRefs } from "@/foundations/utils/compose-refs/compose-refs";
import { cn } from "@/lib/utils";

type HSVA = [number, number, number, number];

interface ColorPickerContextType {
  color: HSVA;
  onChange?: (color: HSVA) => void;
  disabled?: boolean;
}

const ColorPickerContext = createContext<ColorPickerContextType | null>(null);

const useColorPickerContext = () => {
  const context = use(ColorPickerContext);

  if (!context) {
    throw new Error("ColorPicker components must be used within a ColorPicker");
  }

  return context;
};

interface ColorPickerProps
  extends Omit<React.ComponentPropsWithRef<"div">, "color" | "onChange"> {
  color?: HSVA;
  onColorChange?: (color: HSVA) => void;
  disabled?: boolean;
}

const HANDLE_SIZE_RADIUS = 10;

const ColorPicker = ({
  children,
  color = [0, 1, 1, 1],
  onColorChange,
  disabled,
  className,
  ref,
  ...props
}: ColorPickerProps) => {
  const contextValue = useMemo(
    () => ({
      color,
      onChange: onColorChange,
      disabled,
    }),
    [color, onColorChange, disabled]
  );

  return (
    <ColorPickerContext value={contextValue}>
      <div
        ref={ref}
        className={cn(disabled && "pointer-events-none opacity-48", className)}
        {...props}
      >
        {children}
      </div>
    </ColorPickerContext>
  );
};

interface DraggableProps extends React.ComponentPropsWithRef<"div"> {
  onMove: (coords: [number, number]) => void;
  keyMap?: Partial<
    Record<"up" | "down" | "left" | "right", (modifierKey: boolean) => void>
  >;
  disabled?: boolean;
  "aria-label"?: string;
  "aria-valuetext"?: string;
  "aria-valuenow"?: number;
  "aria-valuemin"?: number;
  "aria-valuemax"?: number;
}

const Draggable = ({
  disabled,
  className,
  onMove,
  keyMap = {},
  children,
  "aria-label": ariaLabel,
  "aria-valuetext": ariaValueText,
  "aria-valuenow": ariaValueNow,
  "aria-valuemin": ariaValueMin = 0,
  "aria-valuemax": ariaValueMax = 100,
  ref,
  ...props
}: DraggableProps) => {
  const internalRef = useRef<HTMLDivElement>(null);
  const isSelecting = useRef(false);

  const handleStart = (
    e:
      | MouseEvent
      | TouchEvent
      | React.MouseEvent<HTMLDivElement>
      | React.TouchEvent<HTMLDivElement>
  ) => {
    if (disabled || !internalRef.current) return;

    const el = internalRef.current;
    if (!el.contains(e.target as Node)) return;

    if (e.cancelable) e.preventDefault();

    isSelecting.current = true;

    window.addEventListener("mousemove", handleMove, { passive: false });
    window.addEventListener("touchmove", handleMove, { passive: false });
    window.addEventListener("mouseup", handleStop);
    window.addEventListener("touchend", handleStop);

    onMove(getCoordinatesFromEvent(e));
  };

  const handleStop = () => {
    isSelecting.current = false;

    window.removeEventListener("mousemove", handleMove);
    window.removeEventListener("touchmove", handleMove);
    window.removeEventListener("mouseup", handleStop);
    window.removeEventListener("touchend", handleStop);
  };

  const handleMove = (e: MouseEvent | TouchEvent) => {
    if (!isSelecting.current) return;

    if (e.cancelable) e.preventDefault();

    onMove(getCoordinatesFromEvent(e));
  };

  const getCoordinatesFromEvent = (
    e:
      | MouseEvent
      | TouchEvent
      | React.MouseEvent<HTMLDivElement>
      | React.TouchEvent<HTMLDivElement>
  ) => {
    const rect = internalRef.current?.getBoundingClientRect();

    if (!rect) return [0, 0] as [number, number];

    const clientX = "touches" in e ? (e.touches[0]?.clientX ?? 0) : e.clientX;
    const clientY = "touches" in e ? (e.touches[0]?.clientY ?? 0) : e.clientY;

    const x = clientX - rect.left;
    const y = clientY - rect.top;

    return [
      Math.min(Math.max(x, 0), rect.width),
      Math.min(Math.max(y, 0), rect.height),
    ] as [number, number];
  };

  const handleKeyDown = (e: React.KeyboardEvent<HTMLDivElement>) => {
    if (disabled) return;

    const key = e.key.toLowerCase();
    const modifierKey = e.shiftKey || e.metaKey;

    if (key === "arrowup" && keyMap?.up) {
      e.preventDefault();
      keyMap.up(modifierKey);
    } else if (key === "arrowdown" && keyMap?.down) {
      e.preventDefault();
      keyMap.down(modifierKey);
    } else if (key === "arrowleft" && keyMap?.left) {
      e.preventDefault();
      keyMap.left(modifierKey);
    } else if (key === "arrowright" && keyMap?.right) {
      e.preventDefault();
      keyMap.right(modifierKey);
    }
  };

  return (
    <div
      ref={composeRefs(internalRef, ref)}
      onMouseDown={handleStart}
      onTouchStart={handleStart}
      onKeyDown={handleKeyDown}
      className={cn(
        "group relative cursor-pointer touch-none rounded-xl",
        "focus-visible:ring-accent-element focus-visible:ring-4",
        className
      )}
      tabIndex={disabled ? -1 : 0}
      role="slider"
      aria-label={ariaLabel}
      aria-valuetext={ariaValueText}
      aria-valuenow={ariaValueNow}
      aria-valuemin={ariaValueMin}
      aria-valuemax={ariaValueMax}
      aria-disabled={disabled}
      {...props}
    >
      {children}
    </div>
  );
};

interface ColorPickerHandleProps {
  color: HSVA;
  left: number;
  top?: number;
}

const ColorPickerHandle = ({
  color,
  left,
  top = 0.5,
}: ColorPickerHandleProps) => {
  return (
    <div
      className={cn(
        "absolute h-[var(--size)] w-[var(--size)] -translate-x-1/2 -translate-y-1/2 rounded-full border-[3px] border-white bg-[var(--color)] shadow-lg",
        "transition-transform group-focus-visible:scale-110 group-focus-visible:outline-4 group-focus-visible:outline-[white]/40"
      )}
      style={{
        "--size": `${HANDLE_SIZE_RADIUS * 2}px`,
        "--color": chroma.hsv(color[0], color[1], color[2]).css(),
        left: `${left * 100}%`,
        top: `${top * 100}%`,
      }}
    />
  );
};

const ColorPickerArea = ({
  className,
  ref,
  ...props
}: React.ComponentPropsWithRef<"div">) => {
  const {
    color: [h, s, v, a],
    onChange,
    disabled,
  } = useColorPickerContext();

  const internalRef = useRef<HTMLDivElement>(null);

  const onMove = ([x, y]: [number, number]) => {
    const rect = internalRef.current?.getBoundingClientRect();
    if (!rect) return;

    const normalizedX = x / rect.width;
    const normalizedY = 1 - y / rect.height;
    onChange?.([h, normalizedX, normalizedY, a]);
  };

  const keyMap = {
    up: (modifierKey: boolean) =>
      onChange?.([h, s, Math.min(1, v + (modifierKey ? 0.1 : 0.02)), a]),
    down: (modifierKey: boolean) =>
      onChange?.([h, s, Math.max(0, v - (modifierKey ? 0.1 : 0.02)), a]),
    left: (modifierKey: boolean) =>
      onChange?.([h, Math.max(0, s - (modifierKey ? 0.1 : 0.02)), v, a]),
    right: (modifierKey: boolean) =>
      onChange?.([h, Math.min(1, s + (modifierKey ? 0.1 : 0.02)), v, a]),
  };

  const ariaValueText = `Saturation ${Math.round(s * 100)}%, Value ${Math.round(v * 100)}%`;

  return (
    <Draggable
      ref={composeRefs(internalRef, ref)}
      onMove={onMove}
      keyMap={keyMap}
      disabled={disabled}
      aria-label="Saturation and value"
      aria-valuetext={ariaValueText}
      aria-valuenow={Math.round(((s + v) / 2) * 100)}
      aria-valuemin={0}
      aria-valuemax={100}
      className={cn("aspect-square w-full", className)}
      style={{
        backgroundColor: chroma(h, 1, 1, "hsv").css(),
        backgroundImage: `linear-gradient(transparent, black),
        linear-gradient(to right, white, transparent)`,
      }}
      {...props}
    >
      <ColorPickerHandle color={[h, s, v, a]} top={1 - v} left={s} />
    </Draggable>
  );
};

const ColorPickerHue = ({
  className,
  ref,
  ...props
}: React.ComponentPropsWithRef<"div">) => {
  const {
    color: [h, s, v, a],
    onChange,
    disabled,
  } = useColorPickerContext();

  
// ... truncated ...

```

**src/foundations/ui/color-picker/examples/color-picker.preview.tsx**

```tsx
"use client";

import { useState } from "react";

import {
  ColorPicker,
  ColorPickerArea,
  ColorPickerHue,
  type HSVA,
} from "@/foundations/ui/color-picker/color-picker";

export default function ColorPickerExample() {
  const [color, setColor] = useState<HSVA>([0, 1, 1, 1]);

  return (
    <ColorPicker className="w-48" color={color} onColorChange={setColor}>
      <ColorPickerArea />
      <ColorPickerHue className="mt-2" />
    </ColorPicker>
  );
}

```

**src/foundations/ui/color-picker/examples/color-picker-disabled.preview.tsx**

```tsx
import {
  ColorPicker,
  ColorPickerArea,
  ColorPickerHue,
  type HSVA,
} from "@/foundations/ui/color-picker/color-picker";

export default function ColorPickerDisabled() {
  const color: HSVA = [120, 0.7, 0.8, 1];

  return (
    <ColorPicker color={color} disabled>
      <ColorPickerArea className="size-48" />
      <ColorPickerHue className="mt-2 w-48" />
    </ColorPicker>
  );
}

```

**src/foundations/ui/color-picker/examples/color-picker-multiple-formats.preview.tsx**

```tsx
"use client";

import chroma from "chroma-js";
import { useState } from "react";

import {
  ColorPicker,
  ColorPickerAlpha,
  ColorPickerArea,
  ColorPickerHue,
  ColorPickerSaturation,
  type HSVA,
} from "@/foundations/ui/color-picker/color-picker";

export default function ColorPickerMultipleFormatsExample() {
  const [color, setColor] = useState<HSVA>([0, 1, 1, 1]);

  return (
    <div className="flex justify-center">
      <div className="flex gap-4">
        <div className="flex flex-col gap-4">
          <ColorPicker className="w-36" color={color} onColorChange={setColor}>
            <ColorPickerArea />
            <ColorPickerHue className="mt-2" />
            <ColorPickerSaturation className="mt-2" />
            <ColorPickerAlpha className="mt-2" />
          </ColorPicker>
        </div>

        <div className="flex w-36 flex-col gap-3">
          <div
            className="border-foreground/10 h-8 w-full flex-1 rounded-xl border bg-[var(--bg-color,--alpha(var(--color-foreground)/10%))]"
            style={
              color
                ? {
                    "--bg-color": chroma
                      .hsv(color[0], color[1], color[2])
                      .css(),
                  }
                : {}
            }
          />

          <div className="grid grid-cols-[auto,1fr] gap-x-2 gap-y-1 font-mono text-xs">
            <span className="text-foreground-secondary font-medium">HEX</span>
            <code className="bg-background-secondary rounded px-1.5 py-0.5">
              {chroma.hsv(color[0], color[1], color[2]).hex().toUpperCase()}
            </code>

            <span className="text-foreground-secondary font-medium">RGB</span>
            <code className="bg-background-secondary rounded px-1.5 py-0.5">
              {chroma.hsv(color[0], color[1], color[2]).css()}
            </code>

            <span className="text-foreground-secondary font-medium">HSV</span>
            <code className="bg-background-secondary rounded px-1.5 py-0.5">
              {Math.round(color[0])}, {Math.round(color[1] * 100)}%,{" "}
              {Math.round(color[2] * 100)}%
            </code>
          </div>
        </div>
      </div>
    </div>
  );
}

```

**src/foundations/ui/color-picker/examples/color-picker-picked-color.preview.tsx**

```tsx
"use client";

import { useState } from "react";

import {
  ColorPicker,
  ColorPickerArea,
  ColorPickerHue,
  type HSVA,
} from "@/foundations/ui/color-picker/color-picker";

export default function ColorPickerWithInitialColor() {
  const [color, setColor] = useState<HSVA>([210, 0.8, 0.9, 1]);

  return (
    <ColorPicker className="w-48" color={color} onColorChange={setColor}>
      <ColorPickerArea />
      <ColorPickerHue className="mt-2" />
    </ColorPicker>
  );
}

```

**src/foundations/ui/color-picker/examples/color-picker-all-controls.preview.tsx**

```tsx
"use client";

import { useState } from "react";

import {
  ColorPicker,
  ColorPickerAlpha,
  ColorPickerArea,
  ColorPickerHue,
  ColorPickerLightness,
  ColorPickerSaturation,
  type HSVA,
} from "@/foundations/ui/color-picker/color-picker";

export default function ColorPickerAllControls() {
  const [color, setColor] = useState<HSVA>([280, 0.6, 0.9, 0.8]);

  return (
    <ColorPicker
      className="flex w-40 flex-col gap-2"
      color={color}
      onColorChange={setColor}
    >
      <ColorPickerArea className="size-40" />
      <ColorPickerHue />
      <ColorPickerSaturation />
      <ColorPickerLightness />
      <ColorPickerAlpha />
    </ColorPicker>
  );
}

```
