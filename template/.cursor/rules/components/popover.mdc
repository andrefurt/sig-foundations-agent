# rule: Component – Popover
type: intelligent
scope: **/*
---
## Overview
Short purpose and when-to-use guidance for **Popover**.

## Anatomy
- Structure and slots (leading/trailing/media/actions/meta if applicable).

## Props (typed)
- List key props with types, defaults, and constraints.

## States
- Hover, focus, active, disabled, loading, invalid.

## Accessibility
- Roles, labels, keyboard, focus outline, ARIA attributes.

## Usage Examples
- Basic usage
- With slots (icon/text/secondary action)
- Edge cases (long text, truncation)

## Do / Don't
- Do: keep API surface small; reuse Foundations tokens.
- Don't: hardcode colors; expose unstable DOM structure.

## Notes
Merged documentation from repository and component docs (if present).

---

### Source Docs
# Popover

## Visão geral

`Popover` é um painel flutuante ancorado a um elemento disparador.  Permite mostrar informações adicionais ou controlos contextuais sem sair da página.  Tem posicionamento inteligente, suporte opcional a modal e elementos internos como campo de pesquisa e estado vazio【514903009373180†L23-L27】.

## Funcionalidades principais

- **Posicionamento inteligente**: ajusta automaticamente a posição para se manter visível, suportando deslocamento e rotação【514903009373180†L23-L29】.
- **Gestão de foco**: pode operar em modo **modal** para prender o foco dentro do popover【514903009373180†L23-L25】.
- **Pesquisa integrada**: campo de pesquisa opcional com ícone【514903009373180†L36-L38】.
- **Estado vazio**: componente dedicado para mensagens quando não há conteúdo【514903009373180†L36-L38】.
- **Triggers flexíveis**: permite utilizar qualquer elemento como activador, incluindo renderização via `asChild`【514903009373180†L27-L28】.

## Dependências

- Utiliza `Slot` para mesclar props nos triggers【514903009373180†L7-L9】.
- Utiliza o hook `useTopLayer` para empilhar o painel acima de outros elementos【514903009373180†L11-L13】.
- Biblioteca `@floating-ui/react` para cálculo de posição【514903009373180†L15-L16】.

## Anatomia

```tsx
<Popover>
  <PopoverTrigger />
  <PopoverContent>
    <PopoverClose />
    <PopoverSearchInput />
    <PopoverEmpty />
  </PopoverContent>
</Popover>
```【514903009373180†L31-L39】

Componentes:

- **Popover**: contêiner principal; gere estado aberto e posicionamento【514903009373180†L44-L71】.
- **PopoverTrigger**: botão activador; estende `button` e suporta `asChild`【514903009373180†L74-L83】.
- **PopoverContent**: área de conteúdo que é renderizada em portal【514903009373180†L88-L93】.
- **PopoverClose**: botão para fechar; suporta `asChild`【514903009373180†L94-L106】.
- **PopoverSearchInput**: campo de pesquisa estilizado com ícone【514903009373180†L108-L113】.
- **PopoverEmpty**: contêiner para mensagens de estado vazio【514903009373180†L115-L118】.

## API (Popover)

| Propriedade | Tipo | Predefinição | Descrição |
| --- | --- | --- | --- |
| **open** | `boolean` | – | Controla se o popover está aberto【514903009373180†L46-L51】. |
| **onOpenChange** | `(open: boolean) => void` | – | Callback quando o estado aberto muda【514903009373180†L52-L55】. |
| **placement** | `Placement` | `'bottom'` | Posição do popover relativamente ao activador【514903009373180†L56-L60】. |
| **offset** | `number` | `4` | Distância entre popover e activador【514903009373180†L61-L64】. |
| **modal** | `boolean` | `false` | Quando verdadeiro, prende o foco dentro do popover【514903009373180†L66-L70】. |

## API (PopoverTrigger)

| Propriedade | Tipo | Descrição |
| --- | --- | --- |
| **asChild** | `boolean` | Quando true, o activador é renderizado como filho personalizado【514903009373180†L80-L84】. |

## Boas práticas

- **Posicionamento**: considere o espaço disponível; ajuste `offset` para evitar sobreposição com o activador【514903009373180†L162-L166】.
- **Gestão de foco**: utilize `modal` em interacções mais complexas (por exemplo, formulários); garanta que o teclado navega apenas dentro do popover【514903009373180†L167-L172】.
- **Conteúdo conciso**: mantenha o conteúdo curto; use popovers para informações suplementares, não para fluxos inteiros【514903009373180†L175-L176】.
- **Responsividade**: teste em vários tamanhos de ecrã; ajuste largura do popover quando necessário【514903009373180†L164-L167】.

## Source Snapshot
_Synced from foundations-main (read-only)._

**src/foundations/ui/popover/popover.tsx**

```tsx
"use client";

import {
  autoUpdate,
  flip,
  FloatingContext,
  FloatingFocusManager,
  hide,
  offset as offsetMiddleware,
  Placement,
  shift,
  size,
  useClick,
  useDismiss,
  useFloating,
  UseFloatingOptions,
  useInteractions,
  UseInteractionsReturn,
  useMergeRefs,
  useRole,
  useTransitionStatus,
} from "@floating-ui/react";
import { MagnifyingGlassIcon } from "@phosphor-icons/react";
import { createContext, use, useCallback, useMemo, useState } from "react";

import { Slot } from "@/foundations/components/slot/slot";
import { useTopLayer } from "@/foundations/hooks/use-top-layer/use-top-layer";
import { cn } from "@/lib/utils";

interface UsePopoverFloatingOptions {
  open?: boolean;
  onOpenChange?: UseFloatingOptions["onOpenChange"];
  placement?: Placement;
  offset?: number;
}

const usePopoverFloating = ({
  open: propsOpen,
  onOpenChange: propsOnOpenChange,
  placement = "bottom",
  offset = 4,
}: UsePopoverFloatingOptions) => {
  const [internalOpen, setInternalOpen] = useState(false);
  const open = propsOpen ?? internalOpen;

  const setOpen = useCallback<NonNullable<UseFloatingOptions["onOpenChange"]>>(
    (open, event, reason) => {
      setInternalOpen(open);
      propsOnOpenChange?.(open, event, reason);
    },
    [propsOnOpenChange]
  );

  const floating = useFloating({
    placement,
    open,
    onOpenChange: setOpen,
    whileElementsMounted: (reference, floating, update) =>
      autoUpdate(reference, floating, update, {
        layoutShift: false,
      }),
    middleware: [
      flip({ padding: 8 }),
      shift({ padding: 8 }),
      offsetMiddleware(offset),
      size({
        apply({ rects, elements, availableHeight }) {
          elements.floating.style.setProperty(
            "--max-height",
            `${availableHeight}px`
          );

          elements.floating.style.setProperty(
            "--width",
            `${rects.reference.width}px`
          );
        },
        padding: 4,
      }),
      hide(),
    ],
  });

  return useMemo(
    () => ({
      open,
      setOpen,
      ...floating,
    }),
    [open, setOpen, floating]
  );
};

// Context

interface ContextType
  extends ReturnType<typeof usePopoverFloating>,
    UseInteractionsReturn {
  modal: boolean;
}

const PopoverContext = createContext<ContextType | null>(null);

const usePopoverContext = () => {
  const context = use(PopoverContext);

  if (context == null) {
    throw new Error("Popover components must be wrapped in <Popover />");
  }

  return context;
};

// Components

interface PopoverProps extends UsePopoverFloatingOptions {
  modal?: boolean;
  children: React.ReactNode;
}
/**
 * Popover allows you to open a floating panel that is attached to a trigger element.
 *
 * Set `modal` to `true` to focus trap the popover.
 *
 * @example
 * ```
 * <Popover>
 *   <PopoverTrigger>
 *     <Button>Open Popover</Button>
 *   </PopoverTrigger>
 *   <PopoverContent>
 *     <p>Popover Content</p>
 *   </PopoverContent>
 * </Popover>
 * ```
 */
const Popover = ({ children, modal = false, ...props }: PopoverProps) => {
  const floating = usePopoverFloating(props);

  const click = useClick(floating.context);
  const dismiss = useDismiss(floating.context);
  const role = useRole(floating.context);

  const interactions = useInteractions([click, dismiss, role]);

  const popoverContextValue = useMemo(
    () => ({
      ...floating,
      ...interactions,
      modal,
    }),
    [floating, interactions, modal]
  );

  return (
    <PopoverContext value={popoverContextValue}>{children}</PopoverContext>
  );
};

interface PopoverTriggerProps extends React.ComponentPropsWithRef<"button"> {
  asChild?: boolean;
}

/**
 * Will open the popover when clicked.
 *
 * Use `asChild` to render as your child element.
 *
 * @example
 * ```
 * <PopoverTrigger>
 *   <Button>Open Popover</Button>
 * </PopoverTrigger>
 *
 * <PopoverTrigger asChild={false}>
 *   Open Popover
 * </PopoverTrigger>
 * ```
 */
const PopoverTrigger = ({
  ref: refProp,
  children,
  asChild = false,
  className,
  ...props
}: PopoverTriggerProps) => {
  const context = usePopoverContext();
  const Comp = asChild ? Slot : "button";

  const ref = useMergeRefs([context.refs.setReference, refProp]);

  return (
    <Comp
      ref={ref}
      type={asChild ? undefined : "button"}
      className={cn(!asChild && "disabled:opacity-40", className)}
      data-state={context.open ? "open" : "closed"}
      {...context.getReferenceProps(props)}
    >
      {children}
    </Comp>
  );
};

/**
 * Will render the popover content.
 *
 * @example
 * ```
 * <PopoverContent>
 *   <p>Popover Content</p>
 * </PopoverContent>
 * ```
 */
const PopoverContent = ({
  ref: refProp,
  className,
  children,
  ...props
}: React.ComponentPropsWithRef<"div">) => {
  const { context, refs, getFloatingProps, modal } = usePopoverContext();

  const ref = useMergeRefs([refs.setFloating, refProp]);

  return (
    <PopoverPanel
      context={context}
      modal={modal}
      ref={ref}
      className={cn(
        "border-border bg-background text-foreground z-50 max-h-(--max-height) w-72 overflow-auto rounded-xl border p-3 font-medium shadow-lg outline-none",
        className
      )}
      {...getFloatingProps(props)}
    >
      {children}
    </PopoverPanel>
  );
};

interface PopoverPanelProps extends React.ComponentPropsWithRef<"div"> {
  context: FloatingContext;
  modal?: boolean;
}

/**
 *
 * PopoverPanel is the actual floating panel that will be positioned relative to the trigger.
 * It's exported for internal purposes only, to avoid duplicating the logic of positioning and transitions.
 * It is not part of the public API as it is included already in the PopoverContent component.
 * @returns
 */
const PopoverPanel = ({
  ref,
  context,
  modal,
  className,
  style,
  ...props
}: PopoverPanelProps) => {
  const { isMounted, status } = useTransitionStatus(context, { duration: 150 });
  const topLayerRef = useTopLayer<HTMLDivElement>(isMounted);

  const mergedRef = useMergeRefs([ref, topLayerRef]);

  if (!isMounted) return null;

  return (
    <FloatingFocusManager context={context} modal={modal}>
      <div
        ref={mergedRef}
        data-state={["open", "initial"].includes(status) ? "open" : "closed"}
        data-side={context.placement.split("-")[0]}
        className={cn(
          "ease-out-expo origin-(--transform-origin) transition duration-300",
          "data-[state=closed]:data-[side=bottom]:-translate-y-2 data-[state=closed]:data-[side=left]:translate-x-2 data-[state=closed]:data-[side=right]:-translate-x-2 data-[state=closed]:data-[side=top]:translate-y-2",
          "data-[state=closed]:scale-95 data-[state=closed]:opacity-0 data-[state=closed]:duration-150",
          "data-[state=open]:translate-x-0 data-[state=open]:translate-y-0 data-[state=open]:scale-100",
          className
        )}
        style={{
          position: context.strategy,
          top: context.y ?? 0,
          left: context.x ?? 0,
          "--transform-origin": placementToTransformOrigin(context.placement),
          visibility: context.middlewareData.hide?.referenceHidden
            ? "hidden"
            : "visible",
          ...style,
        }}
        {...props}
      />
    </FloatingFocusManager>
  );
};

// ugly and verbose but easy to reason about and maintain
const placementToTransformOrigin = (placement: Placement) => {
  switch (placement) {
    case "top":
      return "bottom";
    case "bottom":
      return "top";
    case "left":
      return "right";
    case "right":
      return "left";
    case "top-start":
      return "bottom left";
    case "top-end":
      return "bottom right";
    case "bottom-start":
      return "top left";
    case "bottom-end":
      return "top right";
    case "left-start":
      return "right top";
    case "left-end":
      return "right bottom";
    case "right-start":
      return "left top";
    case "right-end":
      return "lef
// ... truncated ...

```

**src/foundations/ui/popover/examples/popover-empty.preview.tsx**

```tsx
import { Button } from "@/foundations/ui/button/button";
import {
  Popover,
  PopoverContent,
  PopoverEmpty,
  PopoverSearchInput,
  PopoverTrigger,
} from "@/foundations/ui/popover/popover";

export default function PopoverEmptyPreview() {
  return (
    <Popover>
      <PopoverTrigger asChild>
        <Button variant="outline">Empty State</Button>
      </PopoverTrigger>
      <PopoverContent className="p-0">
        <PopoverSearchInput placeholder="Search items..." />
        <PopoverEmpty>No items found</PopoverEmpty>
      </PopoverContent>
    </Popover>
  );
}

```

**src/foundations/ui/popover/examples/popover-search.preview.tsx**

```tsx
import { Button } from "@/foundations/ui/button/button";
import {
  Popover,
  PopoverContent,
  PopoverSearchInput,
  PopoverTrigger,
} from "@/foundations/ui/popover/popover";

export default function PopoverSearchPreview() {
  return (
    <Popover>
      <PopoverTrigger asChild>
        <Button variant="outline">Search</Button>
      </PopoverTrigger>
      <PopoverContent className="p-0">
        <PopoverSearchInput placeholder="Search items..." />
        <div className="p-1">Items would go here</div>
      </PopoverContent>
    </Popover>
  );
}

```

**src/foundations/ui/popover/examples/popover.preview.tsx**

```tsx
import { Button } from "@/foundations/ui/button/button";
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from "@/foundations/ui/popover/popover";

export default function PopoverPreview() {
  return (
    <Popover>
      <PopoverTrigger asChild>
        <Button variant="outline">Open Popover</Button>
      </PopoverTrigger>
      <PopoverContent>
        <p>This is the content of the popover.</p>
      </PopoverContent>
    </Popover>
  );
}

```

**src/foundations/ui/popover/examples/popover-placement.preview.tsx**

```tsx
import { Button } from "@/foundations/ui/button/button";
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from "@/foundations/ui/popover/popover";

export default function PopoverPlacementPreview() {
  return (
    <div className="flex flex-wrap items-center justify-center gap-4">
      <Popover placement="top">
        <PopoverTrigger asChild>
          <Button variant="outline">Top</Button>
        </PopoverTrigger>
        <PopoverContent>
          <p>This popover appears on top.</p>
        </PopoverContent>
      </Popover>

      <Popover placement="bottom">
        <PopoverTrigger asChild>
          <Button variant="outline">Bottom</Button>
        </PopoverTrigger>
        <PopoverContent>
          <p>This popover appears at the bottom.</p>
        </PopoverContent>
      </Popover>

      <Popover placement="left">
        <PopoverTrigger asChild>
          <Button variant="outline">Left</Button>
        </PopoverTrigger>
        <PopoverContent>
          <p>This popover appears on the left.</p>
        </PopoverContent>
      </Popover>

      <Popover placement="right">
        <PopoverTrigger asChild>
          <Button variant="outline">Right</Button>
        </PopoverTrigger>
        <PopoverContent>
          <p>This popover appears on the right.</p>
        </PopoverContent>
      </Popover>
    </div>
  );
}

```

**src/foundations/ui/popover/examples/popover-modal.preview.tsx**

```tsx
import { Button } from "@/foundations/ui/button/button";
import {
  Popover,
  PopoverClose,
  PopoverContent,
  PopoverTrigger,
} from "@/foundations/ui/popover/popover";

export default function PopoverModalPreview() {
  return (
    <Popover modal>
      <PopoverTrigger asChild>
        <Button variant="outline">Open Modal Popover</Button>
      </PopoverTrigger>
      <PopoverContent className="flex flex-col gap-4">
        <div>
          <h3 className="mb-1 text-sm font-medium">This is a modal popover</h3>
          <p className="text-foreground-secondary text-sm">
            It will trap focus inside. Very useful for popovers with advanced
            interactions inside (like forms)
          </p>
        </div>
        <div className="flex items-center gap-2">
          <PopoverClose asChild>
            <Button variant="outline" type="button">
              Cancel
            </Button>
          </PopoverClose>
          <Button type="submit">Submit</Button>
        </div>
      </PopoverContent>
    </Popover>
  );
}

```
