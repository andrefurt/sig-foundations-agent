# rule: Component – Dropdown
type: intelligent
scope: **/*
---
## Overview
Short purpose and when-to-use guidance for **Dropdown**.

## Anatomy
- Structure and slots (leading/trailing/media/actions/meta if applicable).

## Props (typed)
- List key props with types, defaults, and constraints.

## States
- Hover, focus, active, disabled, loading, invalid.

## Accessibility
- Roles, labels, keyboard, focus outline, ARIA attributes.

## Usage Examples
- Basic usage
- With slots (icon/text/secondary action)
- Edge cases (long text, truncation)

## Do / Don't
- Do: keep API surface small; reuse Foundations tokens.
- Don't: hardcode colors; expose unstable DOM structure.

## Notes
Merged documentation from repository and component docs (if present).

---

### Source Docs
# Dropdown

## Visão geral

`Dropdown` apresenta uma lista flutuante de opções em relação a um elemento activador.  Adapta‑se à janela, gere foco e suporta pesquisa, secções e selecção múltipla【650160772196056†L29-L37】.

## Funcionalidades principais

- **Posicionamento inteligente**: ajusta automaticamente a posição para permanecer visível【650160772196056†L31-L32】.
- **Gestão de foco**: pode actuar como modal, prendendo o foco dentro da lista【650160772196056†L31-L33】.
- **Suporte a secções**: agrupa itens com cabeçalhos opcionais e divisores【650160772196056†L33-L36】.
- **Pesquisa integrada**: campo de pesquisa para filtrar itens【650160772196056†L33-L35】.
- **Selecção múltipla**: permite seleccionar múltiplos itens com checkboxes【650160772196056†L35-L36】.
- **Itens customizados**: API flexível para renderizar itens complexos【650160772196056†L35-L37】.

## Dependências

- `Popover` – fornece a infraestrutura de painel flutuante【650160772196056†L6-L9】.
- `Divider` e `Slot` para estruturação de itens【650160772196056†L11-L17】.
- `useStableCallback` para manter callbacks estáveis【650160772196056†L19-L21】.
- Biblioteca `@floating-ui/react` para cálculo de posicionamento【650160772196056†L23-L25】.

## Anatomia

```tsx
<Dropdown>
  <DropdownTrigger />
  <DropdownItems>
    <DropdownSection>
      <DropdownHeading />
      <DropdownItem />
      <DropdownDivider />
      <DropdownItem />
    </DropdownSection>
    <DropdownSearchInput />
    <DropdownEmpty />
  </DropdownItems>
</Dropdown>
```【650160772196056†L40-L53】

Componentes principais:

- **Dropdown**: container principal; estende `Popover`【650160772196056†L60-L61】.
- **DropdownTrigger**: botão activador; estende `PopoverTrigger`【650160772196056†L81-L84】.
- **DropdownItems**: lista de opções; estende `PopoverContent`【650160772196056†L85-L89】.
- **DropdownItem**: opção individual; estende `button`【650160772196056†L92-L101】.
- **DropdownSection**: agrupa itens relacionados【650160772196056†L112-L116】.
- **DropdownHeading**: título de uma secção【650160772196056†L118-L121】.
- **DropdownDivider**: linha de separação【650160772196056†L123-L125】.
- **DropdownSearchInput**: campo de pesquisa para filtrar itens【650160772196056†L127-L133】.
- **DropdownEmpty**: mensagem exibida quando não há itens【650160772196056†L134-L139】.

## API (Dropdown)

| Propriedade | Tipo | Predefinição | Descrição |
| --- | --- | --- | --- |
| **modal** | `boolean` | `true` | Define se o dropdown prende o foco dentro dele【650160772196056†L64-L69】. |
| **placement** | `Placement` | `'bottom-start'` | Posição do menu relativamente ao activador【650160772196056†L70-L72】. |
| **onOpenChange** | `(open: boolean) => void` | – | Callback quando o dropdown abre/fecha【650160772196056†L74-L77】. |

### DropdownItem

| Propriedade | Tipo | Descrição |
| --- | --- | --- |
| **asChild** | `boolean` | Permite renderizar o item como filho personalizado【650160772196056†L98-L101】. |
| **onSelect** | `(e: { preventDefault(): void }) => void` | Callback quando o item é seleccionado; chame `preventDefault()` para manter o dropdown aberto【650160772196056†L102-L107】. |

Outros componentes não possuem props específicas além das básicas.

## Boas práticas

- **Organização de conteúdo**: agrupe itens relacionados em secções e use rótulos descritivos【650160772196056†L182-L187】.
- **Design de interacção**: utilize selecção múltipla quando apropriado, adicione pesquisa para listas longas e mostre um estado vazio quando nenhum item corresponder【650160772196056†L189-L194】.
- **Considerações móveis**: garanta alvos de toque grandes e teste o comportamento em diferentes tamanhos de ecrã【650160772196056†L196-L199】.
- **Acessibilidade**: assegure que o dropdown suporta navegação por teclado e que o foco é gerido correctamente; forneça mensagens de estado para leitores de ecrã.

## Source Snapshot
_Synced from foundations-main (read-only)._

**src/foundations/ui/dropdown/dropdown.tsx**

```tsx
"use client";

import {
  FloatingList,
  useClick,
  useDismiss,
  useInteractions,
  UseInteractionsReturn,
  useListItem,
  useListNavigation,
  useMergeRefs,
  useRole,
  useTypeahead,
} from "@floating-ui/react";
import {
  createContext,
  use,
  useCallback,
  useEffect,
  useId,
  useLayoutEffect,
  useMemo,
  useRef,
  useState,
} from "react";

import { Slot } from "@/foundations/components/slot/slot";
import { useStableCallback } from "@/foundations/hooks/use-stable-callback/use-stable-callback";
import { Divider } from "@/foundations/ui/divider/divider";
import {
  Popover,
  PopoverContent,
  PopoverContext,
  PopoverEmpty,
  PopoverSearchInput,
  PopoverTrigger,
  usePopoverContext,
  usePopoverFloating,
} from "@/foundations/ui/popover/popover";
import { cn } from "@/lib/utils";

type Item = {
  id: string;
  label: string;
  onSelect?: (e: { preventDefault: () => void }) => void;
};

type Items = Record<string, Item>;

interface DropdownContextType {
  elementsRef: React.RefObject<(HTMLElement | null)[]>;
  labelsRef: React.RefObject<string[]>;
  highlightedIndex: number | null;
  setHighlightedIndex: (index: number | null) => void;
  searchInputRef: HTMLInputElement | null;
  setSearchInputRef: (el: HTMLInputElement) => void;
  getItemProps: UseInteractionsReturn["getItemProps"];
  items: Items;
  registerItem: (item: Item) => () => void;
}

const DropdownContext = createContext<DropdownContextType | null>(null);

const useInternalDropdownContext = () => {
  const context = use(DropdownContext);

  if (context == null) {
    throw new Error("Dropdown components must be wrapped in <Dropdown />");
  }

  return context;
};

const Dropdown = ({
  children,
  modal = true,
  placement = "bottom-start",
  ...props
}: React.ComponentProps<typeof Popover>) => {
  const floating = usePopoverFloating({ placement, ...props });

  const [highlightedIndex, setHighlightedIndex] = useState<number | null>(null);
  const elementsRef = useRef<(HTMLElement | null)[]>([]);
  const [items, setItems] = useState<Items>({});
  const labelsRef = useRef<string[]>([]);

  const [searchInputRef, setSearchInputRef] = useState<HTMLInputElement | null>(
    null
  );

  useEffect(() => {
    labelsRef.current = Object.values(items).map((item) => item.label);
  }, [items]);

  const registerItem = useCallback((item: Item) => {
    setItems((prev) => ({ ...prev, [item.id]: item }));

    return () => {
      setItems((prev) => {
        delete prev[item.id];
        return prev;
      });
    };
  }, []);

  const click = useClick(floating.context);
  const dismiss = useDismiss(floating.context);
  const role = useRole(floating.context);

  const listNav = useListNavigation(floating.context, {
    listRef: elementsRef,
    activeIndex: highlightedIndex,
    onNavigate: setHighlightedIndex,
    virtual: !!searchInputRef || undefined,
  });

  const typeahead = useTypeahead(floating.context, {
    enabled: !searchInputRef,
    listRef: labelsRef,
    activeIndex: highlightedIndex,
    onMatch: setHighlightedIndex,
  });

  const interactions = useInteractions([
    click,
    dismiss,
    role,
    listNav,
    typeahead,
  ]);

  const popoverContextValue = useMemo(
    () => ({
      ...floating,
      ...interactions,
      modal,
    }),
    [floating, interactions, modal]
  );

  const menuContextValue = useMemo(
    () => ({
      elementsRef,
      labelsRef,
      highlightedIndex,
      setHighlightedIndex,
      searchInputRef,
      setSearchInputRef,
      getItemProps: interactions.getItemProps,
      registerItem,
      items,
    }),
    [
      elementsRef,
      labelsRef,
      highlightedIndex,
      searchInputRef,
      interactions,
      registerItem,
      items,
    ]
  );

  return (
    <PopoverContext value={popoverContextValue}>
      <DropdownContext value={menuContextValue}>{children}</DropdownContext>
    </PopoverContext>
  );
};

const DropdownTrigger = PopoverTrigger;

const DropdownItems = ({
  children,
  className,
  ...props
}: React.ComponentProps<typeof PopoverContent>) => {
  const { elementsRef } = useInternalDropdownContext();

  return (
    <PopoverContent className={cn("p-0", className)} {...props}>
      <FloatingList elementsRef={elementsRef}>{children}</FloatingList>
    </PopoverContent>
  );
};

interface DropdownItemProps extends React.ComponentPropsWithRef<"button"> {
  onSelect?: Item["onSelect"];
  asChild?: boolean;
}

const DropdownItem = ({
  ref: refProp,
  children,
  className,
  disabled,
  onClick,
  onSelect,
  onKeyDown,
  asChild,
  ...props
}: DropdownItemProps) => {
  const itemId = useId();
  const innerRef = useRef<HTMLButtonElement | null>(null);
  const {
    registerItem,
    highlightedIndex,
    getItemProps,
    items,
    searchInputRef,
    elementsRef,
  } = useInternalDropdownContext();
  const popoverCtx = usePopoverContext();
  const stableOnSelect = useStableCallback(onSelect);

  const { ref: listItemRef, index } = useListItem();

  const ref = useMergeRefs([listItemRef, refProp, innerRef]);

  const isHighlighted = highlightedIndex === index;

  const Comp = asChild ? Slot : "button";

  useLayoutEffect(() => {
    const text = innerRef.current?.textContent;

    if (!text) return;

    const unregister = registerItem({
      id: itemId,
      label: text,
      onSelect: stableOnSelect,
    });

    return unregister;
  }, [registerItem, itemId, stableOnSelect]);

  const handleClick = (e: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {
    stableOnSelect?.(e);
    onClick?.(e);

    if (!e.defaultPrevented) {
      popoverCtx.setOpen(false);
    }
  };

  const handleKeyDown = (e: React.KeyboardEvent<HTMLButtonElement>) => {
    if (e.key === "Enter" && highlightedIndex !== null) {
      // we are using elementsRef to preserve DOM order
      // certain items can be unmounted and registered again in a wrong position
      // elementsRef preserves the correct order
      const id = elementsRef.current[highlightedIndex]?.dataset.itemId;
      if (id) items[id]?.onSelect?.(e);
    } else if (searchInputRef) {
      searchInputRef.focus();
    }

    onKeyDown?.(e);
  };

  return (
    <Comp
      ref={ref}
      data-item-id={itemId}
      data-highlighted={isHighlighted || undefined}
      tabIndex={isHighlighted ? 0 : -1}
      disabled={disabled || undefined}
      data-disabled={disabled || undefined}
      className={cn(
        "data-highlighted:bg-background-secondary text-foreground/80 relative mx-1 flex w-[calc(100%-calc(var(--spacing)*2))] cursor-pointer items-center gap-1.5 rounded-lg px-3 py-1.5 text-base font-medium outline-none select-none first-of-type:mt-1 last-of-type:mb-1 data-disabled:pointer-events-none data-disabled:opacity-50",
        className
      )}
      {...getItemProps({
        ...props,
        onKeyDown: handleKeyDown,
        onClick: handleClick,
      })}
    >
      {children}
    </Comp>
  );
};

interface DropdownSectionContextType {
  setTitleId: (id: string) => void;
}

const DropdownSectionContext = createContext<DropdownSectionContextType | null>(
  null
);

const DropdownSection = ({
  children,
  className,
  ...props
}: React.ComponentPropsWithRef<"div">) => {
  const [titleId, setTitleId] = useState<string | undefined>(undefined);

  return (
    <DropdownSectionContext value={{ setTitleId }}>
      <div
        role="group"
        aria-labelledby={titleId}
        className={cn(
          "border-border flex flex-col items-stretch not-first:border-t",
          className
        )}
        {...props}
      >
        {children}
      </div>
    </DropdownSectionContext>
  );
};

const DropdownHeading = ({
  children,
  id: propsId,
  className,
  ...props
}: React.ComponentPropsWithRef<"div">) => {
  const generatedId = useId();
  const id = propsId ?? generatedId;
  const ctx = use(DropdownSectionContext);

  useLayoutEffect(() => {
    if (ctx) ctx.setTitleId(id);
  }, [ctx, id]);

  return (
    <div
      className={cn(
   
// ... truncated ...

```

**src/foundations/ui/dropdown/examples/dropdown.preview.tsx**

```tsx
import { Button } from "@/foundations/ui/button/button";
import {
  Dropdown,
  DropdownItem,
  DropdownItems,
  DropdownTrigger,
} from "@/foundations/ui/dropdown/dropdown";

export default function DropdownPreview() {
  return (
    <Dropdown>
      <DropdownTrigger asChild>
        <Button variant="outline">Open Menu</Button>
      </DropdownTrigger>
      <DropdownItems>
        <DropdownItem>Edit</DropdownItem>
        <DropdownItem>Duplicate</DropdownItem>
        <DropdownItem>Archive</DropdownItem>
        <DropdownItem disabled>Delete</DropdownItem>
      </DropdownItems>
    </Dropdown>
  );
}

```

**src/foundations/ui/dropdown/examples/dropdown-multiple.preview.tsx**

```tsx
"use client";

import { useState } from "react";

import { Button } from "@/foundations/ui/button/button";
import { Checkbox } from "@/foundations/ui/checkbox/checkbox";
import {
  Dropdown,
  DropdownItem,
  DropdownItems,
  DropdownTrigger,
} from "@/foundations/ui/dropdown/dropdown";

const people = [
  { id: 1, name: "Durward Reynolds" },
  { id: 2, name: "Kenton Towne" },
  { id: 3, name: "Therese Wunsch" },
  { id: 4, name: "Benedict Kessler" },
  { id: 5, name: "Katelyn Rohan" },
];

export default function DropdownMultiplePreview() {
  const [selected, setSelected] = useState<number[]>([]);

  return (
    <Dropdown>
      <DropdownTrigger asChild>
        <Button variant="outline">Select People</Button>
      </DropdownTrigger>
      <DropdownItems>
        {people.map((person) => (
          <DropdownItem
            key={person.id}
            className="px-2"
            onSelect={(e) => {
              e.preventDefault(); // prevent close
              setSelected((prev) =>
                prev.includes(person.id)
                  ? prev.filter((id) => id !== person.id)
                  : [...prev, person.id]
              );
            }}
          >
            <Checkbox
              className="pointer-events-none"
              checked={selected.includes(person.id)}
              readOnly
            />
            <span>{person.name}</span>
          </DropdownItem>
        ))}
      </DropdownItems>
    </Dropdown>
  );
}

```

**src/foundations/ui/dropdown/examples/dropdown-empty.preview.tsx**

```tsx
import { Button } from "@/foundations/ui/button/button";
import {
  Dropdown,
  DropdownEmpty,
  DropdownItems,
  DropdownSearchInput,
  DropdownTrigger,
} from "@/foundations/ui/dropdown/dropdown";

export default function DropdownEmptyPreview() {
  return (
    <Dropdown>
      <DropdownTrigger asChild>
        <Button variant="outline">Empty Menu</Button>
      </DropdownTrigger>
      <DropdownItems>
        <DropdownSearchInput placeholder="Search items..." />
        <DropdownEmpty>No items found</DropdownEmpty>
      </DropdownItems>
    </Dropdown>
  );
}

```

**src/foundations/ui/dropdown/examples/dropdown-icons.preview.tsx**

```tsx
import {
  ArchiveIcon,
  CopyIcon,
  PencilSimpleIcon,
  TrashIcon,
} from "@phosphor-icons/react/dist/ssr";

import { Button } from "@/foundations/ui/button/button";
import {
  Dropdown,
  DropdownItem,
  DropdownItems,
  DropdownTrigger,
} from "@/foundations/ui/dropdown/dropdown";

export default function DropdownIconsPreview() {
  return (
    <Dropdown>
      <DropdownTrigger asChild>
        <Button variant="outline">Menu with Icons</Button>
      </DropdownTrigger>
      <DropdownItems>
        <DropdownItem>
          <PencilSimpleIcon />
          Edit
        </DropdownItem>
        <DropdownItem>
          <CopyIcon />
          Duplicate
        </DropdownItem>
        <DropdownItem>
          <ArchiveIcon />
          Archive
        </DropdownItem>
        <DropdownItem disabled>
          <TrashIcon />
          Delete
        </DropdownItem>
      </DropdownItems>
    </Dropdown>
  );
}

```

**src/foundations/ui/dropdown/examples/dropdown-search-create.preview.tsx**

```tsx
"use client";

import { UserCircleIcon } from "@phosphor-icons/react/dist/ssr";
import { useMemo, useState } from "react";

import { Avatar, AvatarFallback } from "@/foundations/ui/avatar/avatar";
import { Button } from "@/foundations/ui/button/button";
import { Checkbox } from "@/foundations/ui/checkbox/checkbox";
import {
  Dropdown,
  DropdownDivider,
  DropdownEmpty,
  DropdownItem,
  DropdownItems,
  DropdownSearchInput,
  DropdownTrigger,
} from "@/foundations/ui/dropdown/dropdown";

type Person = { id: number; name: string };

const initialPeople: Person[] = [
  { id: 1, name: "Durward Reynolds" },
  { id: 2, name: "Kenton Towne" },
  { id: 3, name: "Therese Wunsch" },
  { id: 4, name: "Benedict Kessler" },
  { id: 5, name: "Katelyn Rohan" },
  { id: 6, name: "Demetrius Ward" },
  { id: 7, name: "Eleanora Fisher" },
  { id: 8, name: "Augustus Palmer" },
  { id: 9, name: "Cordelia Blake" },
  { id: 10, name: "Sebastian Hayes" },
];

export default function DropdownSearchCreatePreview() {
  const [people, setPeople] = useState<Person[]>(initialPeople);
  const [selected, setSelected] = useState<Person[]>([]);
  const [search, setSearch] = useState("");

  const filteredPeople = useMemo(() => {
    return people.filter((person) =>
      person.name.toLowerCase().includes(search.toLowerCase())
    );
  }, [search, people]);

  const onOpenChange = (open: boolean) => {
    if (!open) {
      setTimeout(() => {
        setSearch("");
        setPeople((prev) => [
          ...selected,
          ...prev.filter((person) => !selected.some((s) => s.id === person.id)),
        ]);
      }, 200); // wait for menu to close
    }
  };

  return (
    <div className="border-border w-96 rounded-3xl border p-4">
      <Dropdown onOpenChange={onOpenChange}>
        <DropdownTrigger asChild>
          <Button variant="outline">Select People</Button>
        </DropdownTrigger>
        <DropdownItems>
          <DropdownSearchInput
            placeholder="Search people"
            value={search}
            onChange={(e) => setSearch(e.target.value)}
          />
          {filteredPeople.map((person) => (
            <DropdownItem
              key={person.id}
              className="px-2"
              onSelect={(e) => {
                e.preventDefault(); // prevent close
                setSelected((prev) =>
                  prev.some((p) => p.id === person.id)
                    ? prev.filter((p) => p.id !== person.id)
                    : [...prev, person]
                );
              }}
            >
              <Checkbox
                className="pointer-events-none"
                checked={selected.some((p) => p.id === person.id)}
                readOnly
              />
              <span>{person.name}</span>
            </DropdownItem>
          ))}
          {filteredPeople.length === 0 && (
            <DropdownEmpty>No results</DropdownEmpty>
          )}
          {search && (
            <>
              <DropdownDivider />
              <DropdownItem
                onSelect={() => {
                  const newPerson = {
                    id: people.length + 1,
                    name: search,
                  };
                  setPeople((prev) => [...prev, newPerson]);
                  setSelected((prev) => [...prev, newPerson]);
                  setSearch("");
                }}
              >
                Create &quot;{search}&quot;
              </DropdownItem>
            </>
          )}
        </DropdownItems>
      </Dropdown>
      {selected.length > 0 ? (
        <div className="mt-4 flex flex-wrap items-center -space-x-2 gap-y-2">
          {selected.map((person) => (
            <Avatar key={person.id} size="sm">
              <AvatarFallback>{person.name[0]}</AvatarFallback>
            </Avatar>
          ))}
        </div>
      ) : (
        <div className="text-foreground-secondary mt-4 flex h-8 items-center gap-1 text-sm">
          <UserCircleIcon className="text-base" /> No people selected
        </div>
      )}
    </div>
  );
}

```
