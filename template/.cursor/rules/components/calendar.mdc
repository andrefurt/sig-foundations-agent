# rule: Component – Calendar
type: intelligent
scope: **/*
---
## Overview
Short purpose and when-to-use guidance for **Calendar**.

## Anatomy
- Structure and slots (leading/trailing/media/actions/meta if applicable).

## Props (typed)
- List key props with types, defaults, and constraints.

## States
- Hover, focus, active, disabled, loading, invalid.

## Accessibility
- Roles, labels, keyboard, focus outline, ARIA attributes.

## Usage Examples
- Basic usage
- With slots (icon/text/secondary action)
- Edge cases (long text, truncation)

## Do / Don't
- Do: keep API surface small; reuse Foundations tokens.
- Don't: hardcode colors; expose unstable DOM structure.

## Notes
Merged documentation from repository and component docs (if present).

---

### Source Docs
# Calendar

## Visão geral

`Calendar` permite seleccionar uma data única ou um intervalo de datas, com controlos para navegar entre meses e anos.  Suporta múltiplos modos, primeira semana configurável e internacionalização via API `Intl`【599426086484581†L19-L26】.

## Funcionalidades principais

- **Modos múltiplos**: seleção de **data única** ou **intervalo de datas**【599426086484581†L21-L24】.
- **Primeiro dia da semana configurável**: escolha qual dia inicia a semana (domingo=0 até sábado=6)【599426086484581†L86-L90】.
- **Internacionalização**: utiliza `Intl` para formatar datas e nomes de dias, com suporte a diferentes locais【599426086484581†L23-L96】.
- **Restrições de datas**: pode desactivar datas específicas através de uma função `getIsDisabled`【599426086484581†L98-L103】.
- **Navegação**: botões para mudar de mês e ano【599426086484581†L24-L26】.

## Dependências

- `Button` – usado nos controlos de navegação【599426086484581†L9-L15】.
- Biblioteca `date-fns` para manipulação de datas【599426086484581†L13-L15】.

## API

### Quando `mode="single"`

| Propriedade | Tipo | Predefinição | Descrição |
| --- | --- | --- | --- |
| **mode** | `'single'` | `'single'` | Define o modo de seleção【599426086484581†L33-L40】. |
| **value** | `Date` | – (obrigatório) | Data actualmente seleccionada【599426086484581†L42-L46】. |
| **onDateChange** | `(date: Date) => void` | – (obrigatório) | Callback ao seleccionar uma nova data【599426086484581†L47-L51】. |

### Quando `mode="range"`

| Propriedade | Tipo | Descrição |
| --- | --- | --- |
| **mode** | `'range'` (obrigatório) | Activa o modo de intervalo【599426086484581†L61-L67】. |
| **value** | `[Date, Date]` | Par de datas que representam início e fim do intervalo【599426086484581†L67-L70】. |
| **onDateChange** | `(dates: [Date, Date]) => void` | Callback ao seleccionar um intervalo【599426086484581†L73-L75】. |

### Propriedades comuns

| Propriedade | Tipo | Predefinição | Descrição |
| --- | --- | --- | --- |
| **startWeekOn** | `0‒6` | `0` | Dia que inicia a semana (0=Domingo)【599426086484581†L86-L90】. |
| **locale** | `Intl.LocalesArgument` | `'en'` | Localização para formatação【599426086484581†L92-L96】. |
| **getIsDisabled** | `(date: Date) => boolean` | – | Função que retorna `true` para datas desactivadas【599426086484581†L98-L103】. |

## Boas práticas

- **Validação de datas**: verifique sempre as datas antes de passar para o componente e considere fusos horários【599426086484581†L139-L143】.
- **Acessibilidade**: forneça instruções claras sobre o formato de data e navegação; use labels visíveis e mensagens de erro claras【599426086484581†L144-L149】.
- **Considerações móveis**: garanta alvos de toque suficientemente grandes e considere usar selectores nativos de data em dispositivos móveis【599426086484581†L151-L155】.
- **Validação e feedback**: indique claramente datas inválidas ou desactivadas para evitar confusão【599426086484581†L157-L160】.

## Source Snapshot
_Synced from foundations-main (read-only)._

**src/foundations/ui/calendar/calendar.tsx**

```tsx
"use client";

import { CaretLeftIcon, CaretRightIcon } from "@phosphor-icons/react";
import { add, format, isSameDay, isSameMonth } from "date-fns";
import { useMemo, useState } from "react";

import { Button } from "@/foundations/ui/button/button";
import { cn } from "@/lib/utils";

/**
 * Generate a matrix of dates for a given month
 * Dates from previous and next month are included and marked as negative numbers.
 *
 * @param year The year
 * @param month The month (1-12)
 * @param options Configuration options
 * @returns Matrix of dates. Each row is a week, each column is a day.
 */
const generateMonth = (
  year: number,
  month: number,
  options: {
    onlyCurrentMonthRows?: boolean;
    startWeekOn?: 0 | 1 | 2 | 3 | 4 | 5 | 6;
  } = {}
): readonly (readonly number[])[] => {
  const date = new Date(year, month - 1);
  const startWeekOn = options.startWeekOn ?? 1; // Default to Monday (1)
  const firstWeekDay = (date.getDay() - startWeekOn + 7) % 7;
  const daysInMonth = new Date(year, month, 0).getDate();
  const daysInPrevMonth = new Date(year, month - 1, 0).getDate();

  const generateDay = (index: number): number => {
    const currentDay = index - firstWeekDay + 1;
    if (currentDay <= 0) {
      return -(daysInPrevMonth + currentDay);
    } else if (currentDay > daysInMonth) {
      return -(currentDay - daysInMonth);
    }
    return currentDay;
  };

  const generateWeek = (weekIndex: number): readonly number[] =>
    Array.from({ length: 7 }, (_, i) => generateDay(weekIndex * 7 + i));

  const matrix = Array.from({ length: 6 }, (_, i) => generateWeek(i));

  return options.onlyCurrentMonthRows
    ? matrix.filter((week) => week.some((day) => day > 0))
    : matrix;
};

interface CalendarCommonProps extends React.ComponentPropsWithRef<"div"> {
  getIsDisabled?: (date: Date) => boolean;
  startWeekOn?: 0 | 2 | 1 | 3 | 4 | 5 | 6;
  locale?: Intl.LocalesArgument;
}

interface CalendarSingleProps extends CalendarCommonProps {
  value: Date | null;
  onDateChange: (date: Date) => void;
  mode?: "single";
}

interface CalendarRangeProps extends CalendarCommonProps {
  value: [Date, Date] | null;
  onDateChange: (dates: [Date, Date]) => void;
  mode: "range";
}

type CalendarProps = CalendarSingleProps | CalendarRangeProps;

type CalendarView = "days" | "months" | "years";

const sortDates = (dates: [Date, Date]): [Date, Date] => {
  return [...dates].sort((a, b) => a.getTime() - b.getTime()) as [Date, Date];
};

const Calendar = ({
  mode,
  onDateChange,
  value,
  getIsDisabled = () => false,
  startWeekOn = 0,
  locale = "en",
  className,
  ...props
}: CalendarProps) => {
  const [view, setView] = useState<CalendarView>("days");
  const [viewDate, setViewDate] = useState<Date>(
    mode === "range" ? value?.[0] || new Date() : value || new Date()
  );

  // used to track a date range while it's being selected
  const [transientRange, setTransientRange] = useState<[Date, Date] | null>(
    null
  );

  const [startDate, endDate] = useMemo(() => {
    if (transientRange) {
      return sortDates(transientRange);
    }

    if (!value) {
      return [null, null];
    }

    if (mode === "range") {
      return sortDates(value);
    }

    return sortDates([value, value]);
  }, [mode, value, transientRange]);

  const month = useMemo(() => {
    const matrix = generateMonth(
      viewDate.getFullYear(),
      viewDate.getMonth() + 1,
      {
        startWeekOn,
      }
    );

    return matrix.map((row, i) =>
      row.map((day) => {
        const year = viewDate.getFullYear();
        const month = viewDate.getMonth();
        const date = new Date(year, month, 1);

        if (i === 0 && day < 0) {
          date.setMonth(date.getMonth() - 1);
        } else if (day < 0) {
          date.setMonth(date.getMonth() + 1);
        }

        date.setDate(Math.abs(day));

        return date;
      })
    );
  }, [viewDate, startWeekOn]);

  const handleDaySelect = (date: Date) => {
    // not a range selection
    if (mode !== "range") {
      return onDateChange(date);
    }

    // start a range selection
    if (!transientRange) {
      return setTransientRange([date, date]);
    }

    // end selection
    setTransientRange(null);
    return onDateChange(sortDates([transientRange[0], date]));
  };

  const handleDayHover = (date: Date) => {
    if (mode !== "range" || !transientRange) return;

    setTransientRange([transientRange[0], date]);
  };

  return (
    <div className={cn("bg-background", className)} {...props}>
      {view === "years" && (
        <CalendarHeader
          onPrevious={() => setViewDate((prev) => add(prev, { years: -12 }))}
          onNext={() => setViewDate((prev) => add(prev, { years: 12 }))}
        >
          <HeaderTextButton
            className="flex items-center gap-1"
            onClick={() => setView("days")}
          >
            <span>{viewDate.getFullYear() - 5}</span>
            <span>{"–"}</span>
            <span>{viewDate.getFullYear() + 6}</span>
          </HeaderTextButton>
        </CalendarHeader>
      )}
      {view === "months" && (
        <CalendarHeader
          onPrevious={() => setViewDate((prev) => add(prev, { years: -1 }))}
          onNext={() => setViewDate((prev) => add(prev, { years: 1 }))}
        >
          <HeaderTextButton onClick={() => setView("years")}>
            {viewDate.getFullYear()}
          </HeaderTextButton>
        </CalendarHeader>
      )}
      {view === "days" && (
        <CalendarHeader
          onPrevious={() => setViewDate((prev) => add(prev, { months: -1 }))}
          onNext={() => setViewDate((prev) => add(prev, { months: 1 }))}
        >
          <div className="flex items-center gap-1 text-sm">
            <HeaderTextButton onClick={() => setView("months")}>
              {viewDate.toLocaleDateString(locale, { month: "long" })}
            </HeaderTextButton>
            <HeaderTextButton onClick={() => setView("years")}>
              {viewDate.getFullYear()}
            </HeaderTextButton>
          </div>
        </CalendarHeader>
      )}

      <div className="relative">
        {(view === "years" || view === "months") && (
          <div className="bg-background absolute inset-0 z-10 p-1">
            {view === "years" && (
              <div className="grid size-full grid-cols-3 grid-rows-4 p-0.5">
                {Array.from({ length: 12 }, (_, i) => {
                  const year = viewDate.getFullYear() - 5 + i;
                  const date = new Date(year, viewDate.getMonth(), 1);
                  return (
                    <YearMonthButton
                      key={i}
                      className="h-full"
                      onClick={() => {
                        setViewDate(date);
                        setView("months");
                      }}
                    >
                      {year}
                    </YearMonthButton>
                  );
                })}
              </div>
            )}
            {view === "months" && (
              <div className="grid size-full grid-cols-3 grid-rows-4 p-0.5">
                {Array.from({ length: 12 }, (_, i) => {
                  const date = new Date(viewDate.getFullYear(), i, 1);
                  return (
                    <YearMonthButton
                      key={i}
                      className="h-full"
                      onClick={() => {
                        setViewDate(date);
                        setView("days");
                      }}
                    >
                      {date.toLocaleDateString(locale, { month: "short" })}
                    </YearMonthButton>
                  );
                })}
              </div>
            )}
          </div>
        )}

        <div className="grid grid-cols-7">
          {Array.from({ length: 7 }, (_, i) => {
            const weekday = new Date(2024, 0, (i + startWeekOn) % 7);
            return (
              <div
                key={i}
                class
// ... truncated ...

```

**src/foundations/ui/calendar/examples/calendar-start-day.preview.tsx**

```tsx
"use client";

import { useState } from "react";

import { Calendar } from "@/foundations/ui/calendar/calendar";

export default function CalendarStartDayPreview() {
  const [selectedDate, setSelectedDate] = useState<Date | null>(null);

  return (
    <Calendar
      value={selectedDate}
      onDateChange={setSelectedDate}
      startWeekOn={1} // Start on Monday
    />
  );
}

```

**src/foundations/ui/calendar/examples/calendar-locale.preview.tsx**

```tsx
"use client";

import { useState } from "react";

import { Calendar } from "@/foundations/ui/calendar/calendar";

export default function CalendarLocalePreview() {
  const [selectedDate, setSelectedDate] = useState<Date | null>(null);

  return (
    <Calendar value={selectedDate} onDateChange={setSelectedDate} locale="pt" />
  );
}

```

**src/foundations/ui/calendar/examples/calendar.preview.tsx**

```tsx
"use client";

import { useState } from "react";

import { Calendar } from "@/foundations/ui/calendar/calendar";

export default function CalendarPreview() {
  const [selectedDate, setSelectedDate] = useState<Date | null>(null);

  return <Calendar value={selectedDate} onDateChange={setSelectedDate} />;
}

```

**src/foundations/ui/calendar/examples/calendar-disable-future.preview.tsx**

```tsx
"use client";

import { useState } from "react";

import { Calendar } from "@/foundations/ui/calendar/calendar";

export default function CalendarDisableFuturePreview() {
  const [selectedDate, setSelectedDate] = useState<Date | null>(null);

  return (
    <Calendar
      value={selectedDate}
      onDateChange={setSelectedDate}
      getIsDisabled={(date: Date) => date > new Date()}
    />
  );
}

```

**src/foundations/ui/calendar/examples/calendar-range.preview.tsx**

```tsx
"use client";

import { useState } from "react";

import { Calendar } from "@/foundations/ui/calendar/calendar";

export default function CalendarRangePreview() {
  const [dateRange, setDateRange] = useState<[Date, Date]>([
    new Date(Date.now() - 5 * 24 * 60 * 60 * 1000),
    new Date(),
  ]);

  return (
    <Calendar mode="range" value={dateRange} onDateChange={setDateRange} />
  );
}

```
