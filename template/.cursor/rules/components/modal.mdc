# rule: Component – Modal
type: intelligent
scope: **/*
---
## Overview
Short purpose and when-to-use guidance for **Modal**.

## Anatomy
- Structure and slots (leading/trailing/media/actions/meta if applicable).

## Props (typed)
- List key props with types, defaults, and constraints.

## States
- Hover, focus, active, disabled, loading, invalid.

## Accessibility
- Roles, labels, keyboard, focus outline, ARIA attributes.

## Usage Examples
- Basic usage
- With slots (icon/text/secondary action)
- Edge cases (long text, truncation)

## Do / Don't
- Do: keep API surface small; reuse Foundations tokens.
- Don't: hardcode colors; expose unstable DOM structure.

## Notes
Merged documentation from repository and component docs (if present).

---

### Source Docs
# Modal

## Visão geral

`Modal` fornece uma base não estilizada para apresentar conteúdo num layer superior ao interface principal.  Utiliza o elemento HTML `<dialog>` para garantir acessibilidade e apoio nativo ao comportamento de modais【99757330120794†L37-L39】.

## Funcionalidades principais

- **Base nativa**: constrói sobre o `<dialog>` permitindo foco e interacção consistentes【99757330120794†L37-L39】.
- **Clique fora e tecla ESC**: fecha o modal ao clicar no backdrop ou pressionar `Esc`【99757330120794†L37-L40】.
- **Gestão de foco**: captura o foco ao abrir e restaura ao elemento anterior ao fechar【99757330120794†L40-L42】.
- **Transições suaves**: integra‑se com o hook `useElementTransition` para animar abertura e fecho【99757330120794†L41-L42】.
- **Modos controlado e não controlado**: pode receber `open` e `onOpenChange` para gerir estado externamente【99757330120794†L42-L44】.

## Dependências

- Utiliza `Slot` para renderizar triggers e botões personalizados【99757330120794†L9-L13】.
- Usa `useElementTransition` para animações【99757330120794†L13-L15】.
- Utiliza `composeRefs` para combinar referências【99757330120794†L17-L19】.

## CSS necessário

Para evitar que o fundo role quando o modal está aberto, adicione o seguinte CSS global【99757330120794†L28-L33】:

```css
body:has(dialog[open]) {
  overflow: hidden;
  scrollbar-gutter: stable;
}
```

## Anatomia

```tsx
<Modal>
  <ModalTrigger />
  <ModalContent>
    <ModalTitle />
    <ModalDescription />
    <ModalClose />
  </ModalContent>
</Modal>
```【99757330120794†L48-L56】

Componentes:

- **ModalTrigger**: botão ou elemento que abre o modal【99757330120794†L96-L99】.
- **ModalContent**: contêiner que estende `<dialog>`【99757330120794†L82-L93】.
- **ModalTitle**: título, estende `<h2>`【99757330120794†L123-L127】.
- **ModalDescription**: descrição, estende `<p>`【99757330120794†L137-L140】.
- **ModalClose**: botão para fechar o modal【99757330120794†L109-L120】.

## API

### Modal

| Propriedade | Tipo | Descrição |
| --- | --- | --- |
| **open** | `boolean` | Controla o estado aberto (modo controlado)【99757330120794†L61-L69】. |
| **onOpenChange** | `(open: boolean) => void` | Callback quando o estado aberto muda【99757330120794†L69-L72】. |
| **children** | `ReactNode` | Conteúdo do modal (obrigatório)【99757330120794†L73-L77】. |

### ModalContent

| Propriedade | Tipo | Predefinição | Descrição |
| --- | --- | --- | --- |
| **catchFocus** | `boolean` | `true` | Captura o foco inicial para evitar saltos de scroll【99757330120794†L87-L93】. |

### ModalTrigger / ModalClose / ModalTitle / ModalDescription

Estes componentes suportam a propriedade **asChild** (boolean) para renderização de um elemento personalizado absorvendo os estilos【99757330120794†L96-L134】.

## Boas práticas

- **Acessibilidade**: inclua sempre `ModalTitle` e `ModalDescription` para proporcionar contexto a leitores de ecrã【99757330120794†L163-L167】.
- **Experiência do utilizador**: mantenha o conteúdo focado e conciso; forneça acções claras (por exemplo, “Guardar”/“Cancelar”)【99757330120794†L169-L173】.
- **Performance**: carregue componentes pesados de forma preguiçosa e apague‑os quando o modal fechar para reduzir o consumo de memória【99757330120794†L163-L174】.

## Source Snapshot
_Synced from foundations-main (read-only)._

**src/foundations/ui/modal/modal.tsx**

```tsx
"use client";

import {
  createContext,
  use,
  useCallback,
  useEffect,
  useId,
  useLayoutEffect,
  useMemo,
  useRef,
  useState,
} from "react";

import { Slot } from "@/foundations/components/slot/slot";
import { useElementTransition } from "@/foundations/hooks/use-element-transition/use-element-transition";
import { composeRefs } from "@/foundations/utils/compose-refs/compose-refs";
import { cn } from "@/lib/utils";

// Hook to manage native <dialog> element behavior
const useDialogElement = (
  open: boolean,
  setOpen: (isOpen: boolean) => void
) => {
  const ref = useRef<HTMLDialogElement>(null);

  useLayoutEffect(() => {
    const element = ref.current;
    if (!element) return;

    if (!element.open) {
      // use native showModal() to ensure it receives focus when opened, and ESC closes it
      element.showModal();
    }

    const abortController = new AbortController();
    const { signal } = abortController;

    // Prevent the default cancel event and use internal state to close the drawer instead
    // This ensures drawer closing is synchronized with internal state, preventing layout shifts
    element.addEventListener(
      "cancel",
      (event: Event) => {
        event.preventDefault();
        setOpen(false);
      },
      { signal }
    );

    // Prevent ESC from closing the dialog when the cancel event is prevented.
    // Unsure if this is a browser bug or intended behavior — the ESC key can push through the cancel event for some reason
    element.addEventListener(
      "keydown",
      (event: KeyboardEvent) => {
        if (event.key === "Escape" && open) {
          event.preventDefault();
          setOpen(false);
        }
      },
      { signal }
    );

    // Prevent ESC from closing the dialog when it is inert.
    // If the dialog is opened while inert, the focus goes to the window, which allows ESC to close the dialog unexpectedly.
    window.addEventListener(
      "keydown",
      (event: KeyboardEvent) => {
        if (event.key === "Escape" && element.inert && open) {
          event.preventDefault();
          setOpen(false);
        }
      },
      { signal }
    );

    return () => {
      abortController.abort();
    };
  }, [open, ref, setOpen]);

  useEffect(() => {
    const element = ref.current;
    if (!element || !open) return;

    const handleDialogClick = (event: MouseEvent) => {
      // if the click is on the backdrop, close the drawer
      if ((event.target as HTMLElement).nodeName === "DIALOG") {
        const dialog = event.target as HTMLDialogElement;
        const { top, left, width, height } = dialog.getBoundingClientRect();
        const isOutsideModal =
          top > event.clientY ||
          event.clientY > top + height ||
          left > event.clientX ||
          event.clientX > left + width;

        if (isOutsideModal) {
          event.stopPropagation();
          setOpen(false);
        }
      }
    };

    element.addEventListener("click", handleDialogClick);

    return () => {
      element.removeEventListener("click", handleDialogClick);
    };
  }, [setOpen, open]);

  return ref;
};

const ModalContext = createContext<{
  open: boolean;
  labelId?: string;
  descriptionId?: string;
  setOpen: (open: boolean) => void;
  setLabelId: (id?: string) => void;
  setDescriptionId: (id?: string) => void;
} | null>(null);

const useModalContext = () => {
  const context = use(ModalContext);

  if (!context) {
    throw new Error("Modal component must be used within a Modal");
  }

  return context;
};

interface ModalProps {
  open?: boolean;
  onOpenChange?: (open: boolean) => void;
  children: React.ReactNode;
}

const Modal = ({ open: propsOpen, onOpenChange, children }: ModalProps) => {
  const [internalOpen, setInternalOpen] = useState(false);
  const [labelId, setLabelId] = useState<string | undefined>(undefined);
  const [descriptionId, setDescriptionId] = useState<string | undefined>(
    undefined
  );

  const open = propsOpen ?? internalOpen;

  const setOpen = useCallback(
    (isOpen: boolean) => {
      setInternalOpen(isOpen);
      onOpenChange?.(isOpen);
    },
    [onOpenChange]
  );

  const ctx = useMemo(
    () => ({
      open,
      setOpen,
      labelId,
      setLabelId,
      descriptionId,
      setDescriptionId,
    }),
    [descriptionId, labelId, open, setOpen]
  );

  return <ModalContext value={ctx}>{children}</ModalContext>;
};

interface ModalContentProps extends React.ComponentPropsWithRef<"dialog"> {
  catchFocus?: boolean;
}

const ModalContent = ({
  className,
  children,
  catchFocus = true,
  ...props
}: ModalContentProps) => {
  const { open, labelId, descriptionId, setOpen } = useModalContext();
  const dialogRef = useDialogElement(open, setOpen);

  const {
    ref: transitionRef,
    isMounted,
    status,
  } = useElementTransition<HTMLDialogElement>(open);

  if (!isMounted) return;

  return (
    <dialog
      ref={composeRefs(dialogRef, transitionRef)}
      data-status={status}
      aria-labelledby={labelId}
      aria-describedby={descriptionId}
      className={cn("m-auto", className)}
      {...props}
    >
      {catchFocus && (
        // By default, the HTML <dialog> element focuses the first focusable child when opened.
        // If that element is scrolled out of view, the dialog may jump to it, causing a jarring and confusing scroll.
        // Additionally, browsers like Safari may show focus-visible styles on that element, which can look odd.
        // The following element catches initial focus to prevent these issues.
        <div
          className="sr-only"
          autoFocus
          tabIndex={-1}
          data-modal-focus-catcher=""
        />
      )}
      {children}
    </dialog>
  );
};

interface ModalTriggerProps extends React.ComponentPropsWithRef<"button"> {
  asChild?: boolean;
}

const ModalTrigger = ({ asChild, children, ...props }: ModalTriggerProps) => {
  const { setOpen } = useModalContext();

  const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {
    props.onClick?.(event);

    if (!event.defaultPrevented) {
      setOpen(true);
    }
  };

  const Component = asChild ? Slot : "button";

  return (
    <Component {...props} onClick={handleClick}>
      {children}
    </Component>
  );
};

interface ModalCloseProps extends React.ComponentPropsWithRef<"button"> {
  asChild?: boolean;
}

const ModalClose = ({
  asChild = false,
  children,
  ...props
}: ModalCloseProps) => {
  const { setOpen } = useModalContext();

  const handleClick = (event: React.MouseEvent<HTMLElement>) => {
    props.onClick?.(event as React.MouseEvent<HTMLButtonElement>);

    if (!event.defaultPrevented) {
      setOpen(false);
    }
  };

  const Component = asChild ? Slot : "button";
  return (
    <Component {...props} onClick={handleClick}>
      {children}
    </Component>
  );
};

interface ModalTitleProps extends React.ComponentPropsWithRef<"h2"> {
  asChild?: boolean;
}

const ModalTitle = ({ children, asChild, ...props }: ModalTitleProps) => {
  const generatedId = useId();
  const id = props.id ?? generatedId;

  const { setLabelId } = useModalContext();

  useLayoutEffect(() => {
    setLabelId(id);

    return () => setLabelId(undefined);
  }, [id, setLabelId]);

  const Component = asChild ? Slot : "h2";
  return (
    <Component id={id} {...props}>
      {children}
    </Component>
  );
};

interface ModalDescriptionProps extends React.ComponentPropsWithRef<"p"> {
  asChild?: boolean;
}

const ModalDescription = ({
  children,
  asChild,
  ...props
}: ModalDescriptionProps) => {
  const generatedId = useId();
  const id = props.id ?? generatedId;

  const { setDescriptionId } = useModalContext();

  useLayoutEffect(() => {
    setDescriptionId(id);

    return () => setDescriptionId(undefined);
  }, [id, setDescriptionId]);

  const Component = asChild ? Slot : "p";
  return (
    <Component id={id} {...props}>
      {children}
    </Component>
  );
};

export {
  
// ... truncated ...

```

**src/foundations/ui/modal/examples/modal-controlled.preview.tsx**

```tsx
"use client";

import { useState } from "react";

import { Button } from "@/foundations/ui/button/button";
import { Modal, ModalContent, ModalTitle } from "@/foundations/ui/modal/modal";

const ModalControlledPreview = () => {
  const [open, setOpen] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);

  const handleSubmit = () => {
    setIsSubmitting(true);

    setTimeout(() => {
      setIsSubmitting(false);
      setOpen(false);
    }, 3000);
  };

  const handleCancel = () => {
    setOpen(false);
  };

  return (
    <Modal
      open={open}
      onOpenChange={(isOpen) => setOpen(isSubmitting ? true : isOpen)}
    >
      <Button onClick={() => setOpen(true)} variant="destructive">
        Delete
      </Button>
      <ModalContent inert={isSubmitting} className="rounded-xl p-4">
        <ModalTitle className="my-1 font-semibold">Delete Account</ModalTitle>
        <p>Are you sure you want to proceed?</p>
        <div className="mt-4 flex gap-2">
          <Button
            isLoading={isSubmitting}
            onClick={handleSubmit}
            variant="destructive"
          >
            Delete
          </Button>
          <Button onClick={handleCancel}>Cancel</Button>
        </div>
      </ModalContent>
    </Modal>
  );
};

export default ModalControlledPreview;

```

**src/foundations/ui/modal/examples/modal.preview.tsx**

```tsx
"use client";

import { Button } from "@/foundations/ui/button/button";
import {
  Modal,
  ModalClose,
  ModalContent,
  ModalDescription,
  ModalTitle,
  ModalTrigger,
} from "@/foundations/ui/modal/modal";

const ModalControlledPreview = () => {
  return (
    <Modal>
      <ModalTrigger asChild>
        <Button variant="outline">Open</Button>
      </ModalTrigger>
      <ModalContent className="min-w-xs space-y-6 rounded-xl p-4">
        <div className="space-y-1">
          <ModalTitle className="font-semibold">Title</ModalTitle>
          <ModalDescription>Description</ModalDescription>
        </div>
        <ModalClose asChild>
          <Button variant="outline">Close</Button>
        </ModalClose>
      </ModalContent>
    </Modal>
  );
};

export default ModalControlledPreview;

```

**src/foundations/ui/dialog/dialog.tsx**

```tsx
"use client";

import {
  Modal,
  ModalClose,
  ModalContent,
  ModalDescription,
  ModalTitle,
  ModalTrigger,
} from "@/foundations/ui/modal/modal";
import { cn } from "@/lib/utils";

type DialogProps = React.ComponentProps<typeof Modal>;

const Dialog = ({ ...props }: DialogProps) => {
  return <Modal {...props} />;
};

interface DialogContentProps extends React.ComponentProps<typeof ModalContent> {
  align?: "center" | "top";
}

const DialogContent = ({
  className,
  children,
  align = "center",
  ...props
}: DialogContentProps) => {
  return (
    <ModalContent
      className={cn(
        "bg-background border-border m-auto w-full max-w-md rounded-3xl border p-4 shadow-lg",
        "max-h-[calc(100svh-2rem)] overflow-y-auto backdrop:bg-black/20 backdrop:backdrop-blur-sm",
        "transition-all duration-300 backdrop:transition-all motion-reduce:transition-none motion-reduce:backdrop:transition-none",
        "not-data-[status=open]:translate-y-2 not-data-[status=open]:scale-95 not-data-[status=open]:opacity-0 not-data-[status=open]:duration-150 not-data-[status=open]:backdrop:opacity-0",
        align === "top" && "mt-4",
        className
      )}
      {...props}
    >
      {children}
    </ModalContent>
  );
};

const DialogTrigger = ModalTrigger;

const DialogClose = ModalClose;

const DialogTitle = ({
  children,
  className,
  ...props
}: React.ComponentProps<typeof ModalTitle>) => {
  return (
    <ModalTitle className={cn("pb-2 font-semibold", className)} {...props}>
      {children}
    </ModalTitle>
  );
};

const DialogDescription = ({
  children,
  className,
  ...props
}: React.ComponentProps<typeof ModalDescription>) => {
  return (
    <ModalDescription className={cn("pb-2", className)} {...props}>
      {children}
    </ModalDescription>
  );
};

const DialogActions = ({
  className,
  children,
  ...props
}: React.ComponentPropsWithRef<"div">) => (
  <div
    className={cn(
      "flex flex-col gap-2 pt-4 sm:flex-row sm:justify-start",
      className
    )}
    {...props}
  >
    {children}
  </div>
);

export {
  Dialog,
  DialogActions,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogTitle,
  DialogTrigger,
};

```

**src/foundations/ui/dialog/examples/dialog-tall.preview.tsx**

```tsx
"use client";

import { Button } from "@/foundations/ui/button/button";
import {
  Dialog,
  DialogActions,
  DialogClose,
  DialogContent,
  DialogTitle,
  DialogTrigger,
} from "@/foundations/ui/dialog/dialog";

export default function DialogTallPreview() {
  return (
    <Dialog>
      <DialogTrigger asChild>
        <Button variant="outline">Open Tall Dialog</Button>
      </DialogTrigger>
      <DialogContent>
        <DialogTitle>Very Tall Dialog</DialogTitle>
        <div>
          {Array(20)
            .fill(null)
            .map((_, index) => (
              <p key={index} className="mb-4">
                This is paragraph {index + 1}. Lorem ipsum dolor sit amet,
                consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut
                labore et dolore magna aliqua.
              </p>
            ))}
        </div>
        <DialogActions>
          <DialogClose asChild>
            <Button variant="outline">Close</Button>
          </DialogClose>
        </DialogActions>
      </DialogContent>
    </Dialog>
  );
}

```

**src/foundations/ui/dialog/examples/dialog-arbitrary.preview.tsx**

```tsx
import { XIcon } from "@phosphor-icons/react/dist/ssr";

import { Button } from "@/foundations/ui/button/button";
import {
  Dialog,
  DialogClose,
  DialogContent,
  DialogTrigger,
} from "@/foundations/ui/dialog/dialog";

export default function DialogArbitraryPreview() {
  return (
    <Dialog>
      <DialogTrigger asChild>
        <Button variant="outline">Open Dialog</Button>
      </DialogTrigger>
      <DialogContent className="p-0">
        <DialogClose className="absolute top-3 right-3" asChild>
          <Button variant="outline" size="sm" square>
            <XIcon className="size-4" />
          </Button>
        </DialogClose>
        <div className="flex flex-col items-center rounded-2xl p-6">
          <div className="border-border bg-background-secondary mb-4 size-24 rounded-full border" />
          <h2 className="text-xl font-semibold">John Doe</h2>
          <p className="text-foreground-secondary mb-4 text-sm">
            Software Engineer
          </p>
          <div className="mb-6 flex space-x-4">
            <div className="text-center">
              <p className="font-semibold">1.2k</p>
              <p className="text-foreground-secondary text-xs">Followers</p>
            </div>
            <div className="text-center">
              <p className="font-semibold">3.4k</p>
              <p className="text-foreground-secondary text-xs">Following</p>
            </div>
            <div className="text-center">
              <p className="font-semibold">567</p>
              <p className="text-foreground-secondary text-xs">Posts</p>
            </div>
          </div>
          <Button>Follow</Button>
        </div>
      </DialogContent>
    </Dialog>
  );
}

```
